<h2>Room: {{ room_name }}</h2>

<div id="messages">
    {% for msg in messages %}
        <p><b>{{ msg.user.username }}:</b> {{ msg.content }}</p>
    {% endfor %}
</div>

<input id="messageInput" type="text">
<button id="sendBtn">Send</button>

<script>
    const roomName = "{{ room_name }}";
    const username = "{{ request.user.username }}";

    const socket = new WebSocket(
        "ws://" + window.location.host + "/ws/chat/" + roomName + "/"
    );

    socket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        const messagesDiv = document.getElementById("messages");
        messagesDiv.innerHTML += `<p><b>${data.username}:</b> ${data.message}</p>`;
    };

    document.getElementById("sendBtn").onclick = function () {
        const messageInput = document.getElementById("messageInput");
        socket.send(JSON.stringify({
            "message": messageInput.value,
            "username": username
        }));
        messageInput.value = "";
    };
</script>
